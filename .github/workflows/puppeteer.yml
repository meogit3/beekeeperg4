name: 24/7 Browser Keeper - Shift 4
on:
  schedule:
    - cron: '0 18 * * *' # Starts at 6 PM
  workflow_dispatch:      # Manual start

jobs:
  puppeteer:
    runs-on: ubuntu-latest
    timeout-minutes: 355  # 5 hours 55 minutes
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install Puppeteer
      run: npm install puppeteer
      
    - name: Create and run browser script
      run: |
        cat > keepalive.js << 'EOF'
                const puppeteer = require('puppeteer');
        
        console.log('ðŸš€ Starting Puppeteer session...');
        
        async function runBrowser() {
          const browser = await puppeteer.launch({
            headless: true,
            args: ['--no-sandbox', '--disable-setuid-sandbox']
          });
          
          const page = await browser.newPage();
          console.log('ðŸ¦Š Browser opened successfully');
          
          // Set a 5 hour 50 minute timer (safe margin)
          const startTime = Date.now();
          const maxTime = 5 * 60 * 60 * 1000 + 50 * 60 * 1000;
          
          while (Date.now() - startTime < maxTime) {
            try {
              console.log('ðŸŒ Loading your website...');
              
              // GO TO YOUR WEBSITE - CHANGE THIS URL!
              await page.goto('https://shooo.top/starvuxx', {
                waitUntil: 'networkidle2',
                timeout: 30000
              });
              
              console.log('âœ… Page loaded: ' + new Date().toLocaleTimeString());
              
              // FIXED: Use setTimeout instead of waitForTimeout
              await new Promise(resolve => setTimeout(resolve, 5000)); // Wait 5 seconds
              
              // Scroll randomly
              await page.evaluate(() => {
                window.scrollTo(0, Math.random() * 1000);
              });
              
              console.log('ðŸ–±ï¸  Simulated user activity');
              
              // FIXED: Wait 2-4 minutes before next activity
              const waitTime = 120000 + Math.random() * 120000;
              await new Promise(resolve => setTimeout(resolve, waitTime));
              
            } catch (error) {
              console.log('âŒ Error:', error.message);
              await new Promise(resolve => setTimeout(resolve, 30000)); // Wait 30 seconds on error
            }
          }
          
          await browser.close();
          console.log('ðŸ•’ Session completed after 6 hours');
        }
        
        runBrowser().catch(console.error);
        EOF
        
        node keepalive.js
