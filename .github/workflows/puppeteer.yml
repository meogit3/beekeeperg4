name: 24/7 Browser Keeper - Shift 4
on:
  schedule:
    - cron: '0 18 * * *' # Starts at 6 PM
  workflow_dispatch:      # Manual start

jobs:
  puppeteer:
    runs-on: ubuntu-latest
    timeout-minutes: 355  # 5 hours 55 minutes
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install Puppeteer
      run: npm install puppeteer
      
    - name: Create and run browser script
      run: |
        cat > keepalive.js << 'EOF'
        const puppeteer = require('puppeteer');
        
        console.log('ðŸš€ Starting JS Linux Iframe Keeper...');
        
        async function runBrowser() {
          const browser = await puppeteer.launch({
            headless: true,
            args: ['--no-sandbox', '--disable-setuid-sandbox']
          });
          
          const page = await browser.newPage();
          await page.setViewport({ width: 800, height: 600 });
          
          console.log('ðŸ¦Š Browser opened successfully');
          
          const startTime = Date.now();
          const maxTime = 5 * 60 * 60 * 1000 + 50 * 60 * 1000;
          
          // Load YOUR page that contains the JS Linux iframe
          console.log('ðŸŒ Loading your page with JS Linux iframe...');
          await page.goto('https://shooo.top/starvuxx', {  // CHANGE THIS TO YOUR PAGE URL
            waitUntil: 'networkidle2',
            timeout: 60000
          });
          
          console.log('âœ… Your page with JS Linux iframe loaded: ' + new Date().toLocaleTimeString());
          
          while (Date.now() - startTime < maxTime) {
            try {
              console.log('ðŸ’» Interacting with JS Linux iframe...');
              
              // Focus on the iframe and interact with it
              const iframe = await page.$('iframe[src*="jslinux"]');
              if (iframe) {
                const frame = await iframe.contentFrame();
                
                // Click in the VM to keep it active
                await page.mouse.click(400, 300);
                
                // Press keys occasionally
                await page.keyboard.press('Enter');
                
                console.log('ðŸ–±ï¸  JS Linux iframe activity: ' + new Date().toLocaleTimeString());
              } else {
                console.log('âš ï¸  JS Linux iframe not found, checking page...');
              }
              
              // Wait 1-3 minutes between activities
              const waitTime = 60000 + Math.random() * 120000;
              await new Promise(resolve => setTimeout(resolve, waitTime));
              
            } catch (error) {
              console.log('âŒ Error, reloading page:', error.message);
              await page.reload({ waitUntil: 'networkidle2', timeout: 60000 });
              console.log('ðŸ”„ Page reloaded after error');
              await new Promise(resolve => setTimeout(resolve, 30000));
            }
          }
          
          await browser.close();
          console.log('ðŸ•’ JS Linux session completed after 6 hours');
        }
        
        runBrowser().catch(console.error);         
        EOF
        
        node keepalive.js
